# edv - テスト哲学

このドキュメントでは、edvプロジェクトのテストアプローチを導く基本的なテスト哲学について概説します。

## 基本原則

edvプロジェクトは以下のテスト哲学を採用しています：

1. **テスト駆動開発**：
   - 実用的な場合、機能を実装する前にテストを書く
   - インターフェースとコンポーネントの設計をテストで導く
   - すべての機能が設計上テスト可能であることを確保する

2. **包括的なカバレッジ**：
   - すべてのモジュールで高いテストカバレッジを目指す（>80%目標）
   - 重要なパスとエラー処理のテストを優先する
   - すべての公開APIに包括的なテストスイートを確保する

3. **現実的なシナリオ**：
   - 実際のビデオファイルとシナリオでテストする
   - 実際のユーザーワークフローを表すテストフィクスチャを作成する
   - 様々なメディアフォーマットとエッジケースで動作を検証する

4. **自動テスト**：
   - 継続的な検証のためにテストをCI/CDに統合する
   - 回帰を防ぐために回帰テストを自動化する
   - テストが日常的なワークフローの一部となるよう十分に速く実行されることを確保する

5. **マルチレベルアプローチ**：
   - ユニット、統合、システムレベルのテストを含める
   - 適切なテスト分布でテストピラミッドのバランスを取る
   - 各テストレベルが独自の価値を提供することを確保する

## テストマインドセット

edvのテスト開発において、メンテナーは以下のマインドセットを採用すべきです：

- **ユーザー中心**：ユーザーがどのように機能と対話するかを考慮する
- **敵対的**：理想的なシナリオで動作することを確認するだけでなく、コードを壊そうとする
- **包括的**：成功パスと例外フローの両方をカバーする
- **将来性**：テストが将来の変更にどのように適応するかを考慮する
- **保守性**：明確で簡潔で保守しやすいテストを書く

## テスト品質メトリクス

テスト自体の品質は、以下の基準で測定されます：

- **信頼性**：テストは一貫した結果を生成すべき
- **分離**：テストは他のテストに依存したり影響を与えたりすべきではない
- **速度**：テストは迅速なフィードバックを容易にするために素早く実行すべき
- **明確さ**：テストはその意図と期待される結果を明確に表現すべき
- **保守性**：テストは理解しやすく修正しやすいべき

これらのテスト原則を守ることで、edvプロジェクトは迅速な開発と自信を持ったリファクタリングを可能にしながら、高いソフトウェア品質を維持します。

## 実装状況更新（2024年）

2024年3月の時点で、edvプロジェクトはモジュール全体でさまざまなレベルのカバレッジでテスト哲学の実装において進展を遂げています：

### 現在のテスト状況

| 側面 | 状況 | 実装レベル | 注記 |
|--------|--------|----------------------|-------|
| ユニットテスト | ✅ 完了 | 70% | コア機能にはユニットテストがあり、カバレッジの拡大が進行中 |
| 統合テスト | 🔄 進行中 | 40% | 基本的なモジュール間の相互作用がテストされ、より包括的なテストが必要 |
| システムテスト | 🔶 計画済み | 20% | 初期設定、より包括的なワークフローが必要 |
| パフォーマンステスト | 🔶 計画済み | 10% | 基本的なベンチマークが設計され、実装は保留中 |
| テスト自動化 | 🔄 進行中 | 50% | 基本的なテスト実行が配置され、CIパイプラインの強化が進行中 |

### 主な成果

1. **テストカバレッジ**
   - 完成したユーティリティモジュール（time など）の良好なユニットテストカバレッジ
   - CLIの引数解析とコマンドの強力なテスト
   - FFmpeg検出とバージョン処理の効果的なテスト

2. **テスト駆動開発**
   - 時間処理ユーティリティなどのコンポーネントにTDDを成功裏に採用
   - 使いやすさの向上のためにテストを使用してAPI設計を導いた
   - コア機能のエラーケーステストを実装

3. **構造化テスト**
   - 実装コードとユニットテストを同じ場所に配置
   - 明確なテスト命名規則を実装
   - テストの関心事の良好な分離

### 改善のための重点領域

1. **統合テスト**
   - 専用の`tests/`ディレクトリの確立が必要
   - 包括的なモジュール間相互作用テストを実装
   - メディア操作のためのより多くのテストフィクスチャを作成

2. **複雑なコンポーネントテスト**
   - FFmpegコマンド生成と実行
   - 字幕解析とレンダリング
   - オーディオ処理操作

3. **パフォーマンステスト**
   - パフォーマンスベンチマークの確立
   - メモリ使用量追跡の実装
   - 大きなファイル処理のテストを作成

### 今後のテスト計画

1. **テストインフラストラクチャ**
   - 専用のテストフィクスチャディレクトリを作成
   - 一般的なテスト操作のためのテストヘルパーを実装
   - 継続的なテストのためのCIワークフローを確立

2. **テストツール**
   - コードカバレッジ追跡の導入
   - テスト組織と発見の実装
   - テストレポートの強化

3. **ドキュメント**
   - 貢献者向けのテストガイドを作成
   - テストパターンとベストプラクティスを文書化
   - テスト命名規則と組織を確立

edvプロジェクトは、すべてのモジュールにわたってテストカバレッジと品質を向上させるための継続的な取り組みで、テストアプローチの改善に取り組んでいます。 