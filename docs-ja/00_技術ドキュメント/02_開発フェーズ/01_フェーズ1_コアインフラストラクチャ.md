# フェーズ1：コアインフラストラクチャ（MVP）

このドキュメントでは、edvプロジェクトの最初の開発フェーズについて詳細な内訳を提供します。このフェーズはコアインフラストラクチャとMVP機能の確立に焦点を当てています。

## 概要

フェーズ1では、基本的なアーキテクチャを確立し、基本的なビデオ編集機能を提供します。このフェーズは、その後のすべての開発の基盤を構築するため重要です。

**期間**: 4〜6週間

## 詳細なタスク

### モジュール構造のセットアップ（1週目）

#### 1〜2日目
- Cargoで初期プロジェクトを作成
  - プロジェクト構造を初期化
  - 初期依存関係でCargo.tomlを構成
  - 必要に応じてワークスペース設定をセットアップ
- 設計に従ってディレクトリ構造をセットアップ
  - モジュールフォルダ（cli、core、processingなど）を作成
  - 主要モジュールのプレースホルダーファイルを追加
  - モジュールのエクスポートを構成

#### 3〜5日目
- CI/CDパイプライン（GitHub Actions/GitLab CI）を構成
  - ビルドワークフローをセットアップ
  - テスト自動化を構成
  - 静的解析チェックを実装
- コードスタイルとリンティングルールを確立
  - rustfmtを構成
  - clippyルールをセットアップ
  - コーディング標準をドキュメント化
- テストフレームワークと初期テストをセットアップ
  - テストユーティリティ関数を作成
  - テストフィクスチャをセットアップ
  - 最初の単体テストを実装
- 依存関係管理を構成
  - 重要な依存関係バージョンを固定
  - 依存関係の目的をドキュメント化
  - 依存関係のセキュリティスキャンをセットアップ

### CLIフレームワーク（2週目）

#### 1〜2日目
- clapを使用してコマンドライン引数解析を実装
  - グローバルオプションを定義
  - コマンド構造をセットアップ
  - 引数検証を実装
- メインアプリケーションのエントリーポイントを作成
  - ロギングを初期化
  - エラー処理をセットアップ
  - 構成の読み込みを実装

#### 3〜5日目
- コマンドレジストリシステムを構築
  - コマンドトレイトを作成
  - コマンド登録を実装
  - コマンド検索メカニズムをセットアップ
- ヘルプとバージョンコマンドを実装
  - 詳細なヘルプテキストを作成
  - ヘルプに例を実装
  - バージョン情報を追加
- ターミナル出力フォーマットをセットアップ
  - 色付き出力を実装
  - フォーマットされたエラーメッセージを作成
  - 一貫した出力フォーマットを設計
- 長時間実行操作の進捗表示を実装
  - 進捗バーコンポーネントを作成
  - パーセンテージと推定時間の計算を実装
  - 不確定な進捗のためのスピナーを追加

### FFmpeg統合（2〜3週目）

#### 2週目、3〜5日目
- FFmpeg検出と検証を開発
  - パス検出ロジックを実装
  - バージョン互換性チェックを追加
  - フォールバックメカニズムを作成
- FFmpegラッパーモジュールを作成
  - 抽象化レイヤーを設計
  - 結果解析を実装
  - エラー処理を追加

#### 3週目、1〜3日目
- コマンド構築APIを実装
  - コマンドのための流暢なインターフェースを作成
  - 引数サニタイズを実装
  - 共通操作テンプレートを追加
- プロセス実行とモニタリングを構築
  - サブプロセス管理を実装
  - タイムアウト処理を追加
  - 出力ストリームキャプチャを作成

#### 3週目、3〜5日目
- 出力解析機能を開発
  - 進捗抽出を実装
  - メタデータ解析を作成
  - 構造化された結果オブジェクトを追加
- FFmpegエラーのエラー処理を実装
  - エラーメッセージを解析
  - 型付きエラー結果を作成
  - 回復メカニズムを追加

### 構成管理（3週目）

#### 1〜2日目
- 構成ファイルの読み込み/保存を実装
  - 構成ファイル形式を作成
  - シリアル化/逆シリアル化を実装
  - 構成ファイルの場所検出を追加
- デフォルト構成生成を作成
  - 合理的なデフォルトを定義
  - プラットフォーム固有のデフォルトを実装
  - デフォルト値のドキュメントを追加

#### 3〜5日目
- 環境変数統合を開発
  - 環境変数を構成にマッピング
  - オーバーライド優先順位を実装
  - 利用可能な環境変数をドキュメント化
- 構成検証を構築
  - スキーマ検証を実装
  - 型チェックを追加
  - 役立つ検証エラーメッセージを作成
- ユーザー設定の保存を実装
  - ユーザーごとの構成を作成
  - 永続的な設定を実装
  - 設定移行ロジックを追加

### コアビデオ操作（4〜5週目）

#### 4週目、1〜3日目
- トリム操作を実装
  - 入力検証を開発
    - 時間形式の解析
    - 範囲の検証
    - ファイルの存在チェック
  - FFmpegコマンド生成を作成
    - シークパラメータを実装
    - コーデックオプションを追加
    - ストリーム選択を実装
  - 進捗モニタリングを追加
    - FFmpeg進捗出力を解析
    - 残り時間の推定を実装
    - 進捗コールバックを作成
  - 出力検証を実装
    - 出力ファイルの存在を確認
    - 出力の期間をチェック
    - 出力形式を検証

#### 4週目、3〜5日目から5週目、1〜2日目
- 連結操作を実装
  - 複数の入力処理を開発
    - ファイルリスト管理を実装
    - 入力検証を追加
    - 入力メタデータ抽出を作成
  - 連結デマルチプレクサを実装
    - 連結ファイル生成を作成
    - 形式互換性チェックを追加
    - ストリームマッピングを実装
  - フィルター複合実装を追加
    - 複雑なフィルターグラフ生成を作成
    - トランジション効果を実装
    - オーディオミキシングオプションを追加
  - 形式互換性処理を開発
    - 形式検出を実装
    - 必要に応じてトランスコーディングを追加
    - 形式標準化を作成

#### 5週目、2〜5日目
- カット操作を実装
  - セクション削除ロジックを開発
    - マルチカットサポートを実装
    - セグメント抽出を作成
    - セグメント再組み立てを追加
  - 一時ファイル管理を追加
    - クリーンアップメカニズムを作成
    - アトミック操作を実装
    - エラー回復を追加
  - ストリームコピーの最適化を実装
    - 再エンコードが必要な場合を検出
    - 高速コピーモードを追加
    - コーデック互換性チェックを実装

### テストとドキュメント（6週目）

#### 1〜2日目
- すべてのモジュールの包括的な単体テストを作成
  - コアモジュールのテストカバレッジを実装
  - 外部依存関係のモックを作成
  - エッジケーステストを追加
- エンドツーエンドワークフローの統合テストを開発
  - サンプルビデオを使用したテストフィクスチャを作成
  - ワークフローテストを実装
  - 出力の検証を追加

#### 3〜4日目
- 初期ユーザードキュメントを作成
  - インストール手順を作成
  - コマンドリファレンスを作成
  - 使用例を追加
- 将来の拡張のためのAPIをドキュメント化
  - 公開インターフェースをドキュメント化
  - 開発ガイドを追加
  - モジュールアーキテクチャのドキュメントを作成

#### 5日目
- クロスプラットフォームテストを実行
  - Linux、macOS、およびWindowsでテスト
  - FFmpeg互換性を検証
  - プラットフォーム固有の考慮事項をドキュメント化
- 初期テスト用にMVPをパッケージ化
  - リリースパッケージを作成
  - リリースプロセスを実装
  - 配布の準備をする

## 成果物

フェーズ1の終了までに、以下の成果物が完成している必要があります：

1. 完全なプロジェクト構造とアーキテクチャ
2. コマンド解析機能を備えた機能的なCLI
3. FFmpeg統合レイヤー
4. 構成管理
5. コアビデオ操作（トリム、カット、連結）
6. 単体テストと統合テスト
7. 初期ドキュメント

## 成功基準

フェーズ1は以下の条件が満たされた場合に成功と見なされます：

- すべてのコア操作がプラットフォーム全体で確実に動作する
- コマンドラインインターフェースが機能的でユーザーフレンドリーである
- テストが80%以上のコードカバレッジを提供する
- ドキュメントがインストールと基本操作をカバーしている
- FFmpegがエラー処理を適切に統合している

## 次のフェーズの準備

フェーズ1の最終週には、フェーズ2の準備を開始する必要があります：

- フェーズ1の実装をレビューする
- 得られた教訓に基づいてフェーズ2の計画を改良する
- 対処すべき技術的負債を特定する
- フェーズ2のタスクのためのバックログを準備する

次の開発フェーズの詳細については、[フェーズ2：拡張機能](02_フェーズ2_拡張機能.md)を参照してください。

## 実装状況の更新（2024年）

### フェーズ1の完了状況：完了 ✅

フェーズ1は正常に実装され、edvプロジェクトのコアインフラストラクチャが確立されました。計画されたすべての成果物が達成されています：
フェーズ1は正常に実装され、edvプロジェクトのコアインフラストラクチャが確立されました。計画されたすべての成果物が予定通り達成されています：

**タイムライン**:
- **期間**: 4週間（2023年12月15日〜2024年1月12日）
- **完了日**: 2024年1月12日 ✅ 
- **次フェーズ開始**: 2024年1月25日

#### 完了した成果物

1. **プロジェクト構造とアーキテクチャ**
   - 設計に従ってディレクトリ構造が確立されている
   - モジュール編成は計画されたアーキテクチャを反映している
   - コード編成はRustのベストプラクティスに従っている
   - 設計に従ってディレクトリ構造が確立されている (`src/` に各モジュールが整理)
   - モジュール編成は計画されたアーキテクチャを反映している (`src/lib.rs` で定義)
   - コード編成はRustのベストプラクティスに従っている (モジュール化、エラー処理等)
   - CI/CDパイプラインが `.github/workflows/` に実装され、自動テストを実行

2. **FFmpeg統合レイヤー**
   - FFmpegラッパーが`src/ffmpeg/`に実装されている
   - コマンドビルダーAPIがFFmpeg操作を容易にしている
   - FFmpegプロセスのエラー処理が整備されている
   - バージョン検出と互換性チェックが機能している
   - FFmpegラッパーが`src/ffmpeg/wrapper.rs`に実装されている
   - コマンドビルダーAPIが`src/ffmpeg/command.rs`でFFmpeg操作を容易にしている
   - FFmpegプロセスのエラー処理が`src/ffmpeg/error.rs`で整備されている
   - バージョン検出と互換性チェックが`src/ffmpeg/version.rs`で機能している

3. **CLIフレームワーク**
   - コマンド解析が実装されている
   - ヘルプシステムが包括的なガイダンスを提供している
   - エラーメッセージが明確で実行可能である
   - コマンド登録システムが設計通りに機能している
   - コマンド解析が`src/cli/args.rs`で実装されている
   - ヘルプシステムが`src/cli/help.rs`で包括的なガイダンスを提供している
   - エラーメッセージが`src/cli/error.rs`で明確に定義されている
   - コマンド登録システムが`src/cli/registry.rs`で設計通りに機能している
   - メインのCLIエントリーポイントが`src/main.rs`に実装されている

4. **コアビデオ操作**
   - 基本的なビデオ操作機能が機能している
   - コア操作のFFmpegコマンドが正しい結果を生成する
   - 長時間実行操作の進捗報告が整備されている
   - 基本的なビデオ操作機能が`src/core/video.rs`に実装されている
   - トリム、カット、連結が`src/processing/`ディレクトリに実装されている
   - 進捗報告システムが`src/utility/progress.rs`で整備されている

5. **構成管理**
   - 構成の読み込みと永続化が機能している
   - デフォルト構成が合理的である
   - 環境変数統合が適切に機能している
   - 構成の読み込みと永続化が`src/core/config.rs`に実装されている
   - デフォルト構成値が`src/core/defaults.rs`で定義されている
   - 環境変数統合が`src/core/env.rs`で実装されている

#### 主な成果

- フェーズ1で確立されたアーキテクチャは堅牢で拡張可能であることが証明された
- FFmpegラッパーはコマンドラインオプションの複雑さを適切に抽象化している
- エラー処理は問題に関して明確なフィードバックを提供している
- コア操作はより高度な機能のための信頼性の高い基盤を形成している

#### 学んだ教訓

- FFmpegバージョンの違いは当初計画よりも多くの抽象化を必要とした
- エラー処理は開発の早い段階でより多くの注目を集めるべきであった
- 進捗報告は予想以上にユーザーにとって価値があった
- コマンド構造の設計は後の拡張にとって重要であった

フェーズ1の成功は、現在進行中のフェーズ2作業のための強固な基盤を提供しました。モジュラーアーキテクチャにより、コアインフラストラクチャの大幅なリファクタリングなしに新機能を追加することが容易になりました。

現在の開発進捗状況については、[フェーズ2の状況更新](02_フェーズ2_拡張機能.md#実装状況の更新-2024年)を参照してください。 